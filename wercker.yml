box: ragnarula/typesafe-activator:latest
build:
  steps:
    - script:
        name: Run sbt tests
        code: activator test -Dsbt.ivy.home=$WERCKER_CACHE_DIR/ivy2/ -Divy.home=$WERCKER_CACHE_DIR/ivy2/

    - script:
        name: Build distribution
        code: activator dist -Dsbt.ivy.home=$WERCKER_CACHE_DIR/ivy2/ -Divy.home=$WERCKER_CACHE_DIR/ivy2/

    - script:
        name: Copy dist package
        code: |
          unzip target/universal/dist.zip
          mv target/universal/dist $WERCKER_OUTPUT_DIR/app

deploy:
    box: ragnarula/jdk:8u73-b02_0.1
    hub:
    # use the scratch step to build a container from scratch based on the files present
    - internal/docker-scratch-push:
        username: $HUB_USER
        password: $HUB_PASSWORD
        tag: $WERCKER_GIT_COMMIT, latest
        ports: "9000"
        repository: ragnarula/twitter-sentiment-play
        entrypoint: /app/twitter-sentiment-play